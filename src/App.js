import React, { useState, useMemo, useLayoutEffect } from 'react';

// --- Custom Hook to get real viewport height ---
const useWindowHeight = () => {
  const [height, setHeight] = useState(window.innerHeight);

  useLayoutEffect(() => {
    const handleResize = () => {
      setHeight(window.innerHeight);
    };

    window.addEventListener('resize', handleResize);
    handleResize(); // Set initial height

    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return height;
};


// --- Data for all flashcard decks ---
const allDecks = {
  agency: {
    subject: "Agency",
    cards: [
      { question: "Creating an Agency Relationship", answer: "Requires (1) Assent – principal and agent manifest assent; (2) Benefit – agent agrees to work for the principal’s benefit; and (3) Control – agent agrees to work subject to the principal’s control. No consideration is required." },
      { question: "What is Actual Authority?", answer: "Actual Express Authority is created by written or spoken words. Actual Implied Authority is when the agent takes necessary steps to achieve the principal’s objectives, including actions within accepted business custom." },
      { question: "What is Apparent Authority?", answer: "The principal creates apparent authority through words or conduct that cause a third party to reasonably believe the agent has authority. It exists until the principal notifies the third party." },
      { question: "What is Vicarious Liability (Respondeat Superior)?", answer: "An employer is liable for an employee's torts if: (1) the employer has the right to control the employee's acts, and (2) the tort was committed within the scope of employment. Distinguish between a minor 'detour' (liable) and a major 'frolic' (not liable)." },
      { question: "What is Ratification?", answer: "A principal can be bound by a contract entered into by an agent without authority if the principal later ratifies the transaction. Requires the principal to have knowledge of all material facts, accept the entire transaction, and have capacity." },
      { question: "What are an agent's duties to the principal?", answer: "An agent owes the principal fiduciary duties, including the duty of loyalty (acting solely for the principal's benefit), the duty of care (acting as a reasonable agent would), and the duty of obedience (following all lawful instructions)." },
      { question: "When can a principal be liable for an independent contractor's torts?", answer: "Generally, a principal is not liable for the torts of an independent contractor. Exceptions exist for (1) inherently dangerous activities, (2) non-delegable duties, and (3) when the principal is estopped from denying an agency relationship." },
      { question: "What is the difference between a disclosed, partially disclosed, and undisclosed principal?", answer: "Disclosed: Third party knows the agent is acting for a principal and knows the principal's identity. Partially Disclosed: Third party knows the agent is acting for a principal but does not know the principal's identity. Undisclosed: Third party does not know the agent is acting for a principal." },
      { question: "Who is liable on a contract with a partially disclosed or undisclosed principal?", answer: "Both the agent and the principal are liable on the contract. The third party can choose to hold either one liable." },
      { question: "How can an agency relationship be terminated?", answer: "By (1) lapse of a specified time, (2) happening of a specified event, (3) change of circumstances, (4) breach of fiduciary duty by the agent, (5) unilateral act of either party, or (6) death or incapacity of either party." },
      { question: "What is 'lingering authority'?", answer: "A form of apparent authority that may continue after an agent's actual authority has been terminated. To terminate lingering authority, the principal must provide notice to third parties who previously dealt with the agent." },
      { question: "What is an agent's liability to a third party for breach of warranty of authority?", answer: "If an agent purports to act on behalf of a principal but lacks the authority to do so, the agent may be liable to the third party for breaching an implied warranty of authority." },
      { question: "Can a principal be liable for an agent's intentional torts?", answer: "Yes, if the tort occurred within the scope of employment. This is more likely if (1) force is authorized in the employment (e.g., bouncer), (2) friction is generated by the employment (e.g., bill collector), or (3) the agent is acting to further the principal's business." },
      { question: "What is the duty of loyalty for an agent?", answer: "An agent must act solely for the benefit of the principal. This includes not taking personal profits from the agency relationship, not dealing with the principal as an adverse party, and not competing with the principal." },
      { question: "What is the principal's duty to indemnify an agent?", answer: "A principal has a duty to indemnify an agent for payments made or liabilities incurred by the agent in carrying out the principal's instructions." },
    ]
  },
  partnerships: {
    subject: "Partnerships",
    cards: [
      { question: "How is a General Partnership formed?", answer: "An association of two or more persons to carry on as co-owners a business for profit. No formality is required. The sharing of profits creates a presumption of a partnership." },
      { question: "What is the liability of a general partner?", answer: "Each partner is an agent of the partnership and is jointly and severally liable for all partnership obligations, including torts and contracts." },
      { question: "What fiduciary duties do partners owe to the partnership?", answer: "Partners owe a duty of loyalty (no self-dealing, usurping opportunities, or competing) and a duty of care (no grossly negligent or reckless conduct)." },
      { question: "How does a new partner's liability differ for pre-existing debts?", answer: "A new partner is not personally liable for partnership obligations that arose before their admission. However, their capital contribution can be used to satisfy those debts." },
      { question: "What is the difference between a general partnership and a limited liability partnership (LLP)?", answer: "In an LLP, partners are not personally liable for the obligations of the partnership. An LLP must be formed by filing a statement of qualification with the state." },
      { question: "What is 'partnership by estoppel'?", answer: "If a person represents themselves as a partner (or consents to being represented as one) and a third party extends credit to the partnership in reliance on that representation, the person is liable as if they were a partner." },
      { question: "What is the default rule for management rights in a general partnership?", answer: "Unless otherwise agreed, all partners have equal rights in the management and control of the partnership business. Ordinary business matters are decided by a majority vote of the partners." },
      { question: "What is the default rule for sharing profits and losses?", answer: "Unless otherwise agreed, profits are shared equally among the partners. Losses are shared in the same proportion as profits." },
      { question: "What is a partner's right to remuneration?", answer: "A partner is not entitled to remuneration for services rendered to the partnership, except for reasonable compensation for services in winding up the business." },
      { question: "What is dissociation from a partnership?", answer: "Dissociation is the withdrawal of a partner. It does not necessarily cause a dissolution of the partnership. A wrongfully dissociating partner may be liable for damages." },
      { question: "What is required to form a Limited Partnership (LP)?", answer: "An LP is a partnership with at least one general partner and at least one limited partner. It must be formed by filing a certificate of limited partnership with the state." },
      { question: "What is the liability of a limited partner?", answer: "A limited partner is generally not personally liable for the obligations of the LP beyond their capital contribution." },
      { question: "What happens upon the dissolution of a partnership?", answer: "The partnership must wind up its affairs. This involves liquidating assets, paying off creditors, and distributing any remaining surplus to the partners." },
      { question: "What is the order of distribution of assets upon winding up?", answer: "1. Pay all creditors, including partners who are creditors.\n2. Settle partner accounts by returning capital contributions and distributing profits." },
      { question: "Can a partner transfer their partnership interest?", answer: "Yes, a partner can transfer their interest in the partnership's profits and losses. However, the transferee does not become a partner and has no management rights unless the other partners agree." },
    ]
  },
  civpro: {
    subject: "Civil Procedure",
    cards: [
      { question: "What are the two requirements for Personal Jurisdiction?", answer: "1. The basis for exercising PJ over an out-of-state defendant must be authorized by a state long-arm statute.\n2. The exercise of jurisdiction must be permitted by the Due Process Clause (i.e., sufficient minimum contacts)." },
      { question: "What are the requirements for Diversity Jurisdiction?", answer: "A U.S. District Court has diversity jurisdiction if (1) there is complete diversity (no plaintiff shares citizenship with any defendant) and (2) the amount in controversy exceeds $75,000." },
      { question: "What is the rule for Removal Jurisdiction?", answer: "A defendant can remove a case from state to federal court if the case could have originally been brought in federal court. All defendants must consent. If removal is based on diversity, no defendant can be a citizen of the state where the action was filed." },
      { question: "What is the Erie Doctrine?", answer: "In a diversity case, a federal court will apply its own federal procedural law, but it must apply the substantive law of the state in which it sits. This includes state statutes of limitations and choice-of-law rules. If a federal rule is on point and valid, it will apply." },
      { question: "What is required for Claim Preclusion (Res Judicata)?", answer: "Claim preclusion prevents relitigation of a claim that has already been decided. It requires: (1) a valid, final judgment on the merits; (2) the same parties (or those in privity with them); and (3) the same claim (arising from the same transaction or occurrence)." },
      { question: "What is required for Issue Preclusion (Collateral Estoppel)?", answer: "Issue preclusion prevents relitigation of a specific issue of fact or law. It requires: (1) the issue was actually litigated and determined in the prior case; (2) the issue was essential to the judgment; (3) the prior case ended in a valid, final judgment on the merits; and (4) the party against whom preclusion is asserted had a full and fair opportunity to litigate the issue." },
      { question: "What is the standard for a Motion for Summary Judgment (FRCP 56)?", answer: "The court shall grant summary judgment if the movant shows that there is no genuine dispute as to any material fact and the movant is entitled to judgment as a matter of law. The evidence is viewed in the light most favorable to the non-moving party." },
      { question: "What is the work product doctrine?", answer: "Protects materials prepared in anticipation of litigation from discovery by opposing counsel. It can be overcome if the party seeking discovery shows a substantial need for the materials and an inability to obtain the equivalent without undue hardship. An attorney's mental impressions are almost always absolutely protected." },
      { question: "What are the rules for joinder of parties under FRCP 20?", answer: "Permissive joinder allows multiple plaintiffs to join in one action if they assert any right to relief jointly, severally, or arising out of the same transaction or occurrence, and if any question of law or fact common to all plaintiffs will arise in the action. The same rules apply to joining multiple defendants." },
      { question: "What is impleader (Third-Party Practice) under FRCP 14?", answer: "A defending party may, as a third-party plaintiff, serve a summons and complaint on a nonparty who is or may be liable to it for all or part of the claim against it. This is often used for indemnity or contribution claims." },
      { question: "What is the rule for amending pleadings as a matter of course?", answer: "A party may amend its pleading once as a matter of course within 21 days after serving it or, if the pleading is one to which a responsive pleading is required, 21 days after service of a responsive pleading or 21 days after service of a motion under Rule 12(b), (e), or (f), whichever is earlier." },
      { question: "What is the 'relation back' doctrine for amended pleadings?", answer: "An amendment to a pleading relates back to the date of the original pleading when the amendment asserts a claim or defense that arose out of the conduct, transaction, or occurrence set out in the original pleading." },
      { question: "What is the standard for a preliminary injunction?", answer: "The movant must show: (1) they are likely to succeed on the merits; (2) they are likely to suffer irreparable harm in the absence of preliminary relief; (3) the balance of equities tips in their favor; and (4) an injunction is in the public interest." },
      { question: "What is venue and where is it proper?", answer: "Venue relates to the proper district in which to bring an action. In federal court, venue is proper in a district where any defendant resides (if all reside in the same state), or where a substantial part of the events giving rise to the claim occurred." },
      { question: "What is a compulsory counterclaim?", answer: "A claim that a party has against an opposing party that arises out of the same transaction or occurrence as the opposing party's claim. It must be pleaded in the current action or it is waived." },
    ]
  },
  conflicts: {
    subject: "Conflicts of Laws",
    cards: [
        { question: "What is the Constitutional limitation on choice of law?", answer: "Under the Due Process Clause, a forum state may apply its own law only if it has a significant contact or aggregation of contacts such that the choice of its law is neither arbitrary nor fundamentally unfair." },
        { question: "What is the Full Faith & Credit Clause's role with judgments?", answer: "State courts are required to give full faith and credit to the final judgments of other states, treating them as they would be treated by the courts of the original state, provided the original court had jurisdiction." },
        { question: "What is the Vested Rights Approach (First Restatement)?", answer: "The law that controls is the law of the jurisdiction where the parties’ rights vested. For a tort, this is the place of the injury. For a contract, it is the place where the contract was made." },
        { question: "What is the Most Significant Relationship Approach (Second Restatement)?", answer: "The law of the state with the most significant relationship to the issue is applied, considering connecting facts (contacts) and policy principles (e.g., interests of the states, protecting justified expectations)." },
        { question: "How are Torts cases handled under the Second Restatement?", answer: "The law of the state with the most significant relationship is applied. Key contacts include the place of injury, the place of conduct causing injury, the domicile of the parties, and the place where the relationship between the parties is centered." },
        { question: "How are Contracts cases with a choice-of-law clause handled?", answer: "The parties' choice of law will be upheld if the contract has a substantial relationship to the chosen state or there is some other reasonable basis for the choice, and the chosen law is not contrary to a fundamental policy of the state with the most significant relationship to the issue." },
        { question: "What is dépeçage?", answer: "The process of applying the laws of different states to different issues within the same case. For example, a court might apply the law of State A to the issue of contract validity but the law of State B to the issue of damages." },
        { question: "What law governs procedural matters in a conflicts case?", answer: "The forum state almost always applies its own procedural law, even if it applies the substantive law of another state." },
        { question: "What is the 'governmental interest analysis' approach to choice of law?", answer: "The court examines the laws of the involved states and the policies behind them. If only one state has an interest in applying its law, that law is applied. If both have an interest, the forum applies its own law." },
        { question: "What law governs the validity of a marriage?", answer: "A marriage that is valid where it was celebrated is generally valid everywhere, unless it violates a strong public policy of the state that has the most significant relationship to the spouses and the marriage." },
        { question: "What law governs real property disputes?", answer: "Disputes relating to real property (land) are almost always governed by the law of the state where the property is located (the law of the situs)." },
        { question: "What is the 'borrowing statute' for statutes of limitations?", answer: "Many states have borrowing statutes that direct a court to apply the shorter of the forum state's statute of limitations or the statute of limitations of the state where the cause of action arose." },
        { question: "Can a party collaterally attack a judgment from another state?", answer: "A party can challenge a judgment from another state on the grounds that the original court lacked personal or subject matter jurisdiction, but only if that issue was not fully and fairly litigated in the original action." },
        { question: "What is the 'public policy' exception to enforcing another state's laws?", answer: "A court may refuse to apply a foreign law that is contrary to a strong public policy of the forum state. This is a very narrow exception." },
        { question: "What is renvoi?", answer: "A doctrine where a court applying the law of another state also applies that state's choice-of-law rules, which may refer the court back (renvoi) to its own law. Most states reject the concept of renvoi." },
    ]
  },
  contracts: {
    subject: "Contracts & Sales",
    cards: [
      { question: "What are the essential terms under Common Law vs. UCC?", answer: "Common Law: All essential terms must be covered (parties, subject, price, quantity).\nUCC: Only quantity is essential. The UCC 'fills the gap' for other missing terms if the parties intended to contract." },
      { question: "What is the UCC Firm Offer Rule?", answer: "An offer by a merchant to buy or sell goods in a signed writing which gives assurance it will be held open is not revocable for lack of consideration for the time stated (or a reasonable time, max 3 months)." },
      { question: "What is an Anticipatory Repudiation?", answer: "An anticipatory repudiation occurs when a party, prior to the date of performance, makes an unequivocal and definite statement that they will not perform. The non-repudiating party may (1) treat the repudiation as an immediate breach and sue for damages, (2) suspend their own performance and wait to sue, (3) treat the repudiation as an offer to rescind, or (4) ignore the repudiation and urge performance." },
      { question: "What is the Parol Evidence Rule?", answer: "The Parol Evidence Rule prevents a party to a **fully integrated written contract** from introducing evidence of prior or contemporaneous agreements (oral or written) that contradict, modify, or vary the contractual terms. The rule does not apply to subsequent modifications, evidence to clarify ambiguity, or evidence to show a defense to formation (like fraud or duress)." },
      { question: "What is the difference between an express condition and a constructive condition?", answer: "* An **Express Condition** is a condition explicitly stated in the contract (e.g., using words like 'if,' 'on the condition that,' 'provided that'). Strict compliance with express conditions is required.\n* A **Constructive Condition** (or implied condition) is one that is implied by law. The most common is the constructive condition of exchange, where one party's performance is conditioned on the other party's performance. Substantial performance is sufficient to satisfy a constructive condition." },
      { question: "What is the main rule of the Statute of Frauds?", answer: "The Statute of Frauds requires certain types of contracts to be in writing and signed by the party to be charged to be enforceable. The main categories are contracts for the **M**arriage, contracts that cannot be performed within one **Y**ear, contracts for the sale of **L**and, contracts of an **E**xecutor to answer for a decedent's debt, contracts of **G**uarantee or suretyship, and contracts for the **S**ale of goods for $500 or more (UCC). (Mnemonic: MY LEGS)." },
      { question: "What are expectation damages?", answer: "The standard measure of contract damages. They are intended to put the non-breaching party in the same position they would have been in had the contract been fully performed." },
      { question: "What is the difference between assignment and delegation?", answer: "An **assignment** is the transfer of rights under a contract to a third party. A **delegation** is the transfer of duties under a contract to a third party. While most rights are assignable and duties delegable, the original party (delegator) remains liable for performance." },
      { question: "What is the defense of impracticability?", answer: "Performance is excused if it has become impracticable through no fault of the party seeking to be excused, due to an unforeseen event the non-occurrence of which was a basic assumption of the contract. The event must make performance extremely and unreasonably difficult." },
      { question: "What is the UCC 'Perfect Tender' Rule?", answer: "Under the UCC, if goods or their delivery fail in any respect to conform to the contract, the buyer may reject the whole, accept the whole, or accept any commercial unit or units and reject the rest." },
      { question: "What is a third-party beneficiary?", answer: "A person who is not a party to a contract but has rights under the contract because the contract was intended to benefit them. An intended beneficiary has rights to enforce the contract once their rights have vested." },
      { question: "What is the 'mailbox rule'?", answer: "An acceptance of an offer is effective upon dispatch (e.g., when it is mailed), not upon receipt. This rule does not apply to option contracts or if the offer specifies that acceptance must be received." },
      { question: "What is consideration?", answer: "Consideration is a bargained-for exchange of legal value. A promise is generally unenforceable unless it is supported by consideration. Past consideration is not valid consideration." },
      { question: "What is the difference between a unilateral and a bilateral contract?", answer: "A **bilateral contract** is an exchange of mutual promises. A **unilateral contract** is one where the offeror requests performance rather than a promise, and the contract is formed upon completion of the requested act." },
      { question: "What is the UCC battle of the forms (2-207)?", answer: "An acceptance that contains additional or different terms is still a valid acceptance. Between merchants, the additional terms become part of the contract unless (1) the offer expressly limits acceptance to its terms, (2) the new terms materially alter the contract, or (3) the offeror objects within a reasonable time." },
    ]
  },
  corps: {
    subject: "Corporations",
    cards: [
        { question: "What is Promoter Liability?", answer: "A promoter is personally liable on pre-incorporation contracts. The promoter is only released from liability by a novation (an agreement between the third party, the corporation, and the promoter to substitute the corporation for the promoter)." },
        { question: "What is Piercing the Corporate Veil?", answer: "Courts may disregard the corporate entity and hold shareholders personally liable if they abuse the corporate form, such as by undercapitalization, commingling assets, or defrauding creditors. It requires showing that the corporation is an 'alter ego' of the shareholder and that failure to pierce would result in injustice." },
        { question: "What is the Business Judgment Rule (BJR)?", answer: "The Business Judgment Rule is a rebuttable presumption that a director's decision was made on an informed basis, in good faith, and in the honest belief that the action was in the best interests of the company. It protects directors from liability for poor business decisions." },
        { question: "What are the primary fiduciary duties of a director?", answer: "1. **Duty of Care:** A director must act with the care that a person in a like position would reasonably believe appropriate under similar circumstances.\n2. **Duty of Loyalty:** A director must act in good faith and in a manner the director reasonably believes to be in the best interests of the corporation. This prohibits self-dealing, competing with the corporation, and usurping corporate opportunities." },
        { question: "What is a derivative suit?", answer: "A derivative suit is a lawsuit brought by a shareholder on behalf of the corporation against a third party (often the corporation's own directors or officers). The shareholder must first make a demand on the board to bring the suit, unless such a demand would be futile. Any recovery goes to the corporation, not the shareholder." },
        { question: "What is a quorum for a board of directors meeting?", answer: "A quorum is the minimum number of directors who must be present for the board to transact business. Unless the bylaws state otherwise, a quorum is a majority of the authorized number of directors. A vote can only pass with the approval of a majority of the directors present at the meeting." },
        { question: "What is Rule 10b-5?", answer: "A federal law that prohibits fraud or misrepresentation in connection with the purchase or sale of any security. A private plaintiff must show: (1) a fraudulent act (misstatement or omission), (2) in connection with the purchase or sale of a security, (3) reliance on the fraudulent act, and (4) damages." },
        { question: "What are preemptive rights?", answer: "The right of an existing shareholder to maintain their percentage of ownership by buying a proportional number of shares of any future issuance of common stock. These rights must be explicitly granted in the articles of incorporation." },
        { question: "What is the 'ultra vires' doctrine?", answer: "An act by a corporation that is beyond the scope of the powers granted to it by its articles of incorporation or by law. Ultra vires acts are generally enforceable, but a shareholder can sue to enjoin the act, or the corporation can take action against a director or officer who engaged in the act." },
        { question: "What is a 'de facto' corporation?", answer: "A doctrine that treats a business as a corporation, thereby protecting shareholders from personal liability, if the organizers made a good faith effort to comply with the incorporation statute and had no knowledge of the defect." },
        { question: "What is 'corporation by estoppel'?", answer: "A person who deals with an entity as if it were a corporation is estopped from denying its existence and cannot seek to hold the individual shareholders personally liable. This doctrine typically applies only in contract cases." },
        { question: "What is a shareholder's right to inspect corporate books and records?", answer: "A shareholder has a right to inspect and copy corporate books and records for a proper purpose (one that relates to their interest as a shareholder). They must generally provide written notice." },
        { question: "What is a proxy?", answer: "A proxy is a written authorization given by a shareholder to another person to vote their shares. A proxy is generally revocable unless it states it is irrevocable and is coupled with an interest." },
        { question: "What is a voting trust?", answer: "A written agreement among shareholders to transfer their shares to a trustee, who votes the shares and distributes dividends in accordance with the terms of the trust." },
        { question: "What is required for a fundamental corporate change (e.g., merger, sale of assets)?", answer: "Generally requires a resolution by the board of directors, written notice to shareholders, and approval by a majority of all outstanding shares entitled to vote." },
    ]
  },
  crimlaw: {
    subject: "Criminal Law",
    cards: [
        { question: "What are the four types of Mens Rea under the MPC?", answer: "1. **Purposely:** The defendant's conscious object is to engage in the conduct or cause a certain result.\n2. **Knowingly:** The defendant is aware that their conduct is of a particular nature or that certain circumstances exist.\n3. **Recklessly:** The defendant consciously disregards a substantial and unjustifiable risk.\n4. **Negligently:** The defendant fails to be aware of a substantial and unjustifiable risk." },
        { question: "What is Accomplice Liability?", answer: "A person is an accomplice if they intentionally assist with the crime and act with the purpose of promoting or facilitating its commission. Mere knowledge is not enough. An accomplice is liable for the crime itself and all other foreseeable crimes committed." },
        { question: "What are the elements of Conspiracy?", answer: "1. An agreement between two or more people;\n2. an intent to enter into the agreement and to achieve the objective of the agreement; and\n3. an overt act in furtherance of the conspiracy (in most jurisdictions)." },
        { question: "What is Felony Murder?", answer: "A killing that occurs during the commission or attempted commission of an inherently dangerous felony (usually Burglary, Arson, Rape, Robbery, Kidnapping - BARRK). Malice is implied from the intent to commit the underlying felony." },
        { question: "What is the difference between larceny, embezzlement, and false pretenses?", answer: "All are theft crimes, but they differ in how the defendant acquires the property.\n* **Larceny:** The trespassory taking and carrying away of the personal property of another with the intent to permanently deprive. The defendant never had lawful possession.\n* **Embezzlement:** The fraudulent conversion of the property of another by a person in lawful possession of that property.\n* **False Pretenses:** Obtaining title to the property of another by means of a knowing false representation of a material fact with the intent to defraud." },
        { question: "What are the elements of attempt?", answer: "An attempt requires (1) a **specific intent** to commit the target crime, and (2) a **substantial step** in furtherance of that crime that goes beyond mere preparation." },
        { question: "What is the M'Naghten test for insanity?", answer: "A defendant is entitled to an acquittal if, because of a mental disease or defect, they did not know the nature and quality of the act they were doing, or if they did know it, they did not know that what they were doing was wrong." },
        { question: "What is the defense of duress?", answer: "The defendant reasonably believed that another person would imminently inflict death or great bodily harm upon them or a family member if they did not commit the crime. Duress is not a defense to intentional homicide." },
        { question: "What is the defense of self-defense (non-deadly force)?", answer: "An individual may use non-deadly force in self-defense if they are without fault and reasonably believe that such force is necessary to protect themself from the imminent use of unlawful force by another." },
        { question: "What is the defense of self-defense (deadly force)?", answer: "An individual may use deadly force in self-defense if they are without fault, are faced with unlawful force, and reasonably believe they are threatened with imminent death or great bodily harm. There is no duty to retreat in most jurisdictions." },
        { question: "What is voluntary manslaughter?", answer: "An intentional killing committed in the 'heat of passion' after an adequate provocation. The provocation must be one that would arouse sudden and intense passion in the mind of an ordinary person, causing them to lose self-control." },
        { question: "What is involuntary manslaughter?", answer: "A killing committed with criminal negligence (a gross deviation from the standard of care of a reasonable person) or during the commission of an unlawful act (a misdemeanor or a felony not included in felony murder)." },
        { question: "What are the elements of battery?", answer: "The unlawful application of force to the person of another resulting in either bodily injury or an offensive touching. It is a general intent crime." },
        { question: "What are the two types of assault?", answer: "1. An attempt to commit a battery (a specific intent crime).\n2. The intentional creation of a reasonable apprehension in the mind of the victim of imminent bodily harm (a general intent crime)." },
        { question: "What is the 'Wharton Rule' in conspiracy?", answer: "If a crime requires two or more participants (e.g., adultery, dueling), there is no conspiracy unless more parties participate in the agreement than are necessary for the crime." },
    ]
  },
  crimpro: {
    subject: "Criminal Procedure",
    cards: [
        { question: "When are Miranda rights required?", answer: "Miranda warnings are required when a suspect is subjected to a **custodial interrogation**. 'Custody' is an objective test: would a reasonable person feel they were not free to terminate the interview and leave? 'Interrogation' includes any words or actions by police that they should know are reasonably likely to elicit an incriminating response." },
        { question: "How does a suspect invoke the right to counsel?", answer: "The suspect must make a specific, unambiguous statement asserting their desire to have counsel present. Once invoked, all interrogation must cease until counsel is present." },
        { question: "What is the Fourth Amendment exclusionary rule?", answer: "The exclusionary rule is a judicially created remedy that prohibits the introduction at a criminal trial of evidence obtained in violation of a defendant's Fourth, Fifth, or Sixth Amendment rights. The 'fruit of the poisonous tree' doctrine also excludes evidence derived from the initial illegality." },
        { question: "What is the search incident to a lawful arrest exception?", answer: "Upon a lawful arrest, the police may conduct a contemporaneous search of the person arrested and the areas within their immediate control (their 'wingspan') without a warrant." },
        { question: "What is the automobile exception to the warrant requirement?", answer: "If the police have probable cause to believe a vehicle contains contraband or evidence of a crime, they may search the vehicle without a warrant, including any containers within the vehicle that might reasonably contain the item for which they have probable cause to search." },
        { question: "What is the Sixth Amendment right to counsel?", answer: "The Sixth Amendment provides a right to counsel in all criminal prosecutions. It attaches once formal adversarial judicial proceedings have been initiated (e.g., formal charge, indictment). It is offense-specific, meaning it only applies to the specific crime for which the defendant has been charged." },
        { question: "What is the plain view doctrine?", answer: "Police may seize an item without a warrant if they are lawfully in a position to view the item, it is immediately apparent that the item is contraband or evidence of a crime, and they have a lawful right of access to the item." },
        { question: "What is a 'Terry' stop and frisk?", answer: "A brief, investigatory stop is permissible if police have a reasonable, articulable suspicion of criminal activity. If police also have a reasonable belief that the person is armed and dangerous, they may conduct a protective frisk (a pat-down of the outer clothing) for weapons." },
        { question: "What is the 'good faith' exception to the exclusionary rule?", answer: "Evidence obtained in reasonable, good-faith reliance on a facially valid search warrant that is later found to be defective will not be excluded." },
        { question: "What is required for a valid consent to a search?", answer: "Consent must be voluntary and intelligent. The person granting consent must have authority to do so (or apparent authority)." },
        { question: "What is the Double Jeopardy Clause?", answer: "The Fifth Amendment provides that a person cannot be tried twice for the same offense. It attaches in a jury trial when the jury is sworn in, and in a bench trial when the first witness is sworn in." },
        { question: "What is required for a guilty plea to be valid?", answer: "The plea must be voluntary and intelligent. The judge must address the defendant personally in open court to ensure they understand the nature of the charge, the maximum possible penalty, and that they are waiving their right to a trial." },
        { question: "What is the standard for ineffective assistance of counsel?", answer: "The claimant must show (1) that their counsel's performance fell below an objective standard of reasonableness, and (2) that there is a reasonable probability that, but for counsel's unprofessional errors, the result of the proceeding would have been different." },
        { question: "What is the 'public safety' exception to Miranda?", answer: "Police can ask questions reasonably prompted by a concern for public safety without giving Miranda warnings." },
        { question: "When does a photo identification violate due process?", answer: "A photo ID procedure violates due process if it is unnecessarily suggestive and there is a substantial likelihood of misidentification." },
    ]
  },
  evidence: {
    subject: "Evidence",
    cards: [
        { question: "Define Relevance.", answer: "Evidence is relevant if: (a) it has any tendency to make a fact more or less probable than it would be without the evidence; and (b) the fact is of consequence in determining the action. (FRE 401)" },
        { question: "When is character evidence admissible in a criminal case?", answer: "The prosecution cannot introduce a defendant's bad character to prove propensity. However, the defendant may 'open the door' by offering evidence of their own good character or the victim's bad character for a relevant trait." },
        { question: "What is Hearsay?", answer: "An out-of-court statement offered to prove the truth of the matter asserted. It is generally inadmissible unless it falls under an exception or exclusion." },
        { question: "What is the 'Admissions by a Party-Opponent' exclusion?", answer: "A statement made by a party to the litigation is not hearsay if it is offered by an opposing party. (FRE 801(d)(2))" },
        { question: "What is the 'Excited Utterance' exception?", answer: "A statement relating to a startling event or condition, made while the declarant was under the stress of excitement that it caused. (FRE 803(2))" },
        { question: "What is the Best Evidence Rule?", answer: "The Best Evidence Rule (or Original Document Rule) requires that to prove the contents of a writing, recording, or photograph, the **original writing, recording, or photograph must be produced**. The rule applies only when the contents of the document are at issue. Secondary evidence (like copies or testimony) is admissible only if the original is lost, destroyed, or otherwise unavailable through no fault of the proponent." },
        { question: "What is the difference between the Present Sense Impression and Excited Utterance exceptions to hearsay?", answer: "* **Present Sense Impression:** A statement **describing or explaining** an event or condition, made **while or immediately after** the declarant perceived it. The timing is critical.\n* **Excited Utterance:** A statement **relating to a startling event or condition**, made while the declarant was **under the stress of excitement** that it caused. The key is the declarant's state of mind (still under the stress of the event), which can last longer than the window for a present sense impression." },
        { question: "For what purposes can a defendant's prior bad acts or crimes be admitted?", answer: "Under FRE 404(b), evidence of a defendant's other crimes, wrongs, or acts is not admissible to prove character or propensity. However, it may be admissible for a non-propensity purpose, such as proving **M**otive, **I**ntent, absence of **M**istake, **I**dentity (modus operandi), or **C**ommon plan or scheme. (Mnemonic: MIMIC)." },
        { question: "What is the hearsay exception for Statements Made for Medical Diagnosis or Treatment?", answer: "A statement is not excluded as hearsay if it is made for—and is reasonably pertinent to—medical diagnosis or treatment and describes medical history, past or present symptoms, or their inception or general cause. The statement can be made to any medical professional and need not be made by the patient." },
        { question: "What is the attorney-client privilege?", answer: "Protects confidential communications between an attorney and client made for the purpose of seeking legal advice. The privilege belongs to the client and must be claimed by the client; the attorney's duty of confidentiality is broader and applies regardless of whether the privilege is invoked." },
        { question: "What is the hearsay exception for a statement against interest?", answer: "A statement that a reasonable person in the declarant's position would have made only if they believed it to be true because, when made, it was so contrary to their financial or proprietary interest or had so great a tendency to invalidate their claim against someone else or to expose them to civil or criminal liability. The declarant must be unavailable." },
        { question: "How can a witness be impeached?", answer: "By showing: (1) bias or interest, (2) prior inconsistent statements, (3) prior convictions of certain crimes, (4) prior bad acts involving dishonesty (on cross-examination), (5) a reputation for untruthfulness, or (6) sensory deficiencies." },
        { question: "What is the business records exception to hearsay?", answer: "A record of an act, event, condition, opinion, or diagnosis is not excluded as hearsay if (1) the record was kept in the course of a regularly conducted activity of a business, (2) making the record was a regular practice of that activity, and (3) the record was made at or near the time by someone with knowledge." },
        { question: "What is the rule for subsequent remedial measures?", answer: "Evidence of subsequent measures taken after an injury (e.g., repairs) is not admissible to prove negligence, culpable conduct, a defect in a product, or a need for a warning. It may be admitted for other purposes, such as proving ownership or control." },
        { question: "What is the spousal immunity privilege?", answer: "In a criminal case, a spouse cannot be compelled to testify against their current spouse. The privilege is held by the testifying spouse. It applies to any testimony, not just confidential communications." },
    ]
  },
  family: {
    subject: "Family Law",
    cards: [
        { question: "What are the requirements for a valid common-law marriage?", answer: "To establish a common-law marriage, the parties must (1) have the capacity to marry, (2) presently agree they are married, (3) cohabit, and (4) hold themselves out to the public as married." },
        { question: "What is the standard for determining child custody?", answer: "The standard is the **Best Interests of the Child**. Courts consider many factors, including the wishes of the parents, the wishes of the child (if of sufficient age and maturity), the child's adjustment to home, school, and community, and the mental and physical health of all individuals involved." },
        { question: "What are the requirements for a valid Premarital Agreement under the UPAA?", answer: "It must be in writing and signed. To prevent enforcement, a party must prove (i) involuntariness (fraud/duress), OR (ii) the agreement was unconscionable when executed AND they did not receive/waive fair disclosure of assets." },
        { question: "What is the Uniform Child Custody Jurisdiction and Enforcement Act (UCCJEA)?", answer: "Governs subject-matter jurisdiction for interstate custody disputes. Priority is given to the child's 'home state' (where the child has lived for 6 months prior to the proceeding)." },
        { question: "What is the difference between marital and separate property?", answer: "Marital property is generally all property acquired during the marriage, regardless of whose name is on the title. Separate property is property acquired before the marriage, or during the marriage by gift, bequest, or devise. Most states use equitable distribution to divide marital property." },
        { question: "When can a spousal support award be modified?", answer: "Spousal support can be modified upon a showing of a substantial and material change in circumstances that was not anticipated at the time of the original award." },
        { question: "What are the grounds for a no-fault divorce?", answer: "Most states allow for a no-fault divorce based on (1) irreconcilable differences or (2) living separate and apart for a specified period of time." },
        { question: "What is the legal standard for terminating parental rights?", answer: "The state must prove by clear and convincing evidence that termination is in the best interests of the child. This is a very high standard due to the fundamental nature of parental rights." },
        { question: "What is the Uniform Interstate Family Support Act (UIFSA)?", answer: "UIFSA governs the enforcement of child and spousal support orders across state lines. The state that issued the original order has continuing, exclusive jurisdiction to modify it as long as one of the parties or the child resides in that state." },
        { question: "How is paternity established for a non-marital child?", answer: "Paternity can be established by (1) the parents' subsequent marriage, (2) the father's acknowledgment of paternity, or (3) a court adjudication of paternity." },
        { question: "What is the 'putative spouse' doctrine?", answer: "Allows a party who had a good faith belief that they were lawfully married to acquire the rights of a legal spouse, such as the right to receive property and support, even if the marriage is later found to be void." },
        { question: "Can a parent relocate with a child?", answer: "If parents have joint custody, the relocating parent must generally obtain permission from the other parent or a court order. The court will apply the best interests of the child standard to determine whether to permit the relocation." },
        { question: "What is an annulment?", answer: "An annulment declares a marriage invalid because of an impediment that existed at the time of the marriage. A void marriage is invalid from its inception (e.g., bigamy). A voidable marriage is valid until one party seeks to annul it (e.g., fraud, duress)." },
        { question: "What factors are considered for an award of spousal support (alimony)?", answer: "Courts consider factors such as the duration of the marriage, the standard of living during the marriage, the age and health of the parties, the financial resources of each party, and the contributions of each party to the marriage." },
        { question: "Are professional degrees or licenses considered marital property?", answer: "In most states, no. However, the contributions made by one spouse to the other's education or training may be a factor in the equitable distribution of the marital assets or in an award of alimony." },
    ]
  },
  property: {
    subject: "Real Property",
    cards: [
        { question: "What is a Fee Simple Determinable?", answer: "An estate that automatically terminates upon the happening of a stated condition, and full ownership reverts to the grantor. Created with durational language like 'so long as,' 'until,' or 'while'." },
        { question: "What are the four unities of a Joint Tenancy?", answer: "Time, Title, Interest, and Possession. Joint tenants must acquire their interests at the same time, in the same instrument, with equal shares, and have an equal right to possess the whole property. It includes a right of survivorship." },
        { question: "What is an Easement by Implication (Prior Use)?", answer: "Arises when a landowner subdivides land and a prior use continues. Requires the use to be (1) continuous, (2) apparent or known, and (3) reasonably necessary for the dominant land's use and enjoyment." },
        { question: "What are the elements of Adverse Possession?", answer: "To acquire title through adverse possession, the possession must be:\n1. **Continuous** for the statutory period.\n2. **Open and Notorious** (sufficient to put the true owner on notice).\n3. **Actual** and exclusive.\n4. **Hostile** (without the owner's permission)." },
        { question: "What are the six covenants of title in a general warranty deed?", answer: "* **Present Covenants** (breached, if at all, at the time of conveyance):\n  1. **Covenant of Seisin:** Grantor warrants they own the estate they purport to convey.\n  2. **Covenant of Right to Convey:** Grantor warrants they have the power to make the conveyance.\n  3. **Covenant Against Encumbrances:** Grantor warrants there are no undisclosed physical or title encumbrances on the property.\n* **Future Covenants** (breached, if at all, at some point in the future upon interference by a third party):\n  4. **Covenant of Quiet Enjoyment:** Grantor warrants that the grantee will not be disturbed in possession by a third party's lawful claim of title.\n  5. **Covenant of Warranty:** Grantor agrees to defend against reasonable claims of title by a third party.\n  6. **Covenant of Further Assurances:** Grantor promises to perform whatever acts are reasonably necessary to perfect the title conveyed." },
        { question: "How is a real covenant different from an equitable servitude?", answer: "Both are promises concerning the use of land. The primary difference is the remedy sought for a breach.\n* For a **Real Covenant** to run with the land, you need: a writing, intent for the covenant to run, touch and concern the land, and both horizontal and vertical privity. The remedy for breach is **money damages**.\n* For an **Equitable Servitude** to run with the land, you need: a writing, intent, touch and concern, and notice (for the burdened party). Privity is not required. The remedy for breach is an **injunction**." },
        { question: "What are the three types of recording acts?", answer: "1. **Notice:** A subsequent bona fide purchaser (BFP) for value without notice of a prior interest prevails over the prior interest.\n2. **Race-Notice:** A subsequent BFP for value without notice of a prior interest prevails, but only if they also record first.\n3. **Race:** The first to record prevails, regardless of notice." },
        { question: "What is the implied warranty of habitability?", answer: "A warranty implied in residential leases that the landlord will maintain the property in a condition fit for human habitation. If breached, the tenant may be able to terminate the lease, make repairs and deduct the cost from rent, or seek damages." },
        { question: "What is an easement by necessity?", answer: "An easement by necessity arises when a landowner sells a portion of their property and the resulting division deprives one lot of access to a public road or utility. The easement is strictly necessary for the use of the landlocked parcel." },
        { question: "What is the Rule Against Perpetuities (RAP)?", answer: "No interest is good unless it must vest, if at all, not later than 21 years after some life in being at the creation of the interest. It applies to contingent remainders, executory interests, and vested remainders subject to open." },
        { question: "What is a tenancy in common?", answer: "A concurrent estate where two or more people hold separate fractional interests in the same property. Each tenant has the right to possess the whole property. There is no right of survivorship; each tenant's interest is descendible." },
        { question: "What is the doctrine of equitable conversion?", answer: "Once a contract for the sale of land is signed, equity treats the buyer as the owner of the real property, and the seller's interest (the right to the sale proceeds) is considered personal property. The risk of loss generally passes to the buyer." },
        { question: "What is a mortgage?", answer: "A security interest in real property. The mortgagor is the borrower, and the mortgagee is the lender. If the mortgagor defaults, the mortgagee can foreclose on the property to satisfy the debt." },
        { question: "What is the difference between a life estate and a fee simple?", answer: "A **fee simple** is the highest form of ownership, with potentially infinite duration. A **life estate** is an estate that lasts for the duration of a specified person's life. The holder of a life estate (the life tenant) cannot commit waste." },
        { question: "What is a fixture?", answer: "A fixture is an item of personal property that has been so affixed to real property that it is treated as part of the real property. The determination depends on the degree of attachment, the adaptation of the item to the property, and the intent of the annexor." },
    ]
  },
  secured: {
    subject: "Secured Transactions",
    cards: [
        { question: "What is Attachment?", answer: "The process that makes a security interest enforceable against the debtor. Requires: (1) Value given by the secured party, (2) Debtor has rights in the collateral, and (3) an authenticated Security Agreement describing the collateral (or possession/control)." },
        { question: "What is Perfection?", answer: "The process that gives the secured party rights in the collateral superior to most third parties. Usually achieved by filing a financing statement, but can also be done by possession, control, or automatically in some cases." },
        { question: "What is a Purchase-Money Security Interest (PMSI)?", answer: "A special security interest that arises when a lender gives value to a debtor to enable the debtor to acquire rights in the collateral. A PMSI often has superpriority over other security interests." },
        { question: "Who is a Buyer in the Ordinary Course of Business (BIOC)?", answer: "A person who buys goods in good faith, without knowledge that the sale violates the rights of another, from a person in the business of selling goods of that kind. A BIOC takes free of a security interest created by their seller." },
        { question: "What is the priority rule for a PMSI in inventory?", answer: "A PMSI in inventory has priority over a conflicting security interest in the same inventory if (1) the PMSI is perfected when the debtor receives possession of the inventory, and (2) the PMSI-secured party sends an authenticated notification to the holder of the conflicting security interest before the debtor receives possession." },
        { question: "What is the priority rule for a PMSI in goods other than inventory (e.g., equipment)?", answer: "A PMSI in goods other than inventory or livestock has priority over a conflicting security interest in the same goods if the PMSI is perfected before or within 20 days after the debtor receives possession of the collateral." },
        { question: "What is the general priority rule between two perfected secured parties?", answer: "The first to file a financing statement or to perfect has priority, whichever occurs first." },
        { question: "What is the priority rule between a perfected secured party and a judicial lien creditor?", answer: "A perfected security interest has priority over a subsequent judicial lien. A judicial lien has priority over a prior unperfected security interest." },
        { question: "What are 'proceeds' under Article 9?", answer: "Whatever is acquired upon the sale, lease, license, exchange, or other disposition of collateral. A security interest automatically attaches to identifiable proceeds." },
        { question: "How is a security interest in a deposit account perfected?", answer: "A security interest in a deposit account can only be perfected by control. A secured party has control if (1) the secured party is the bank with which the deposit account is maintained, (2) the debtor, secured party, and bank have agreed in an authenticated record that the bank will comply with the secured party's instructions, or (3) the secured party becomes the bank's customer with respect to the account." },
        { question: "What is a financing statement (UCC-1)?", answer: "The document filed with a state office (usually the Secretary of State) to perfect a security interest. It must contain the debtor's name, the secured party's name, and an indication of the collateral." },
        { question: "What is the 'garage sale' exception?", answer: "A buyer of consumer goods takes free of a security interest, even if perfected, if they buy for their own personal use, for value, and without knowledge of the security interest, unless a financing statement has been filed." },
        { question: "What does it mean for a disposition of collateral after default to be 'commercially reasonable'?", answer: "Every aspect of the disposition, including the method, manner, time, place, and other terms, must be commercially reasonable. The secured party must also send reasonable notification of the disposition to the debtor and any other secured parties." },
        { question: "What is a security interest in 'chattel paper'?", answer: "Chattel paper is a record or records that evidence both a monetary obligation and a security interest in or a lease of specific goods. It can be perfected by filing or by taking possession." },
        { question: "What is an 'after-acquired property' clause?", answer: "A clause in a security agreement that provides for the security interest to attach to property that the debtor acquires in the future. It is generally effective, but does not apply to consumer goods acquired more than 10 days after the secured party gives value." },
    ]
  },
  torts: {
    subject: "Torts",
    cards: [
      { question: "What are the four elements of negligence?", answer: "1. Duty: A duty of reasonable care owed by the defendant to the plaintiff.\n2. Breach: The defendant breached that duty.\n3. Causation: The breach was the actual and proximate cause of the plaintiff's injury.\n4. Damages: The plaintiff suffered actual damages." },
      { question: "What are the four types of Invasion of Privacy?", answer: "1. **Intrusion Upon Seclusion:** An act of prying or intruding into a private place or on the private affairs of another in a manner that is highly offensive to a reasonable person.\n2. **Appropriation of Name or Likeness:** The unauthorized use of the plaintiff's name or likeness for the defendant's commercial advantage.\n3. **False Light:** The widespread publication of a falsehood about a person that would be highly offensive to a reasonable person.\n4. **Public Disclosure of Private Facts:** The widespread publication of private information about the plaintiff that would be highly offensive to a reasonable person and is not of legitimate public concern." },
      { question: "What are the three types of strict products liability?", answer: "1. **Manufacturing Defect:** The product departs from its intended design, making it more dangerous than consumers would expect. The test is whether the product conforms to the defendant's own specifications.\n2. **Design Defect:** All products of a line are dangerous because of a flawed design. The plaintiff must show that a less dangerous, economically feasible alternative design was available (the risk-utility test).\n3. **Failure to Warn (Inadequate Warning):** The product has a non-obvious risk that cannot be eliminated through redesign, and the manufacturer fails to provide an adequate warning of that risk." },
      { question: "What is Negligent Infliction of Emotional Distress (NIED)?", answer: "A plaintiff can recover for NIED in one of two ways:\n1. **Zone of Danger:** The plaintiff was within the zone of physical danger from the defendant's negligence and suffered physical symptoms from the resulting emotional distress.\n2. **Bystander Recovery:** The plaintiff was closely related to a person injured by the defendant, was present at the scene of the injury, and personally observed or perceived the injury." },
      { question: "What is the attractive nuisance doctrine?", answer: "A landowner may be liable for injuries to trespassing children if (1) there is a dangerous artificial condition the owner knows or should know of, (2) the owner knows children are likely to trespass, (3) the child, because of their age, cannot appreciate the risk, and (4) the risk of harm outweighs the utility of the condition." },
      { question: "What is the difference between contributory negligence and comparative negligence?", answer: "* **Contributory Negligence (minority rule):** If the plaintiff is found to be even slightly negligent, they are completely barred from recovery.\n* **Comparative Negligence (majority rule):** The plaintiff's recovery is reduced by their percentage of fault. In a 'pure' system, they can recover even if 99% at fault. In a 'modified' system, they are barred from recovery if their fault is more than 50% (or 50% or more in some states)." },
      { question: "What is joint and several liability?", answer: "When two or more tortfeasors are both found liable for a single, indivisible injury to the plaintiff, each is liable for the entire amount of the plaintiff's damages. The plaintiff can collect the full amount from any one of the defendants." },
      { question: "What is the 'eggshell skull' rule?", answer: "A defendant takes their plaintiff as they find them. The defendant is liable for the full extent of the plaintiff's injuries, even if they are unforeseeably severe due to the plaintiff's pre-existing condition." },
      { question: "What is the standard of care for a professional?", answer: "A professional (e.g., doctor, lawyer, accountant) is required to possess and exercise the knowledge and skill of a member of the profession in good standing in the same or similar communities." },
      { question: "What is res ipsa loquitur?", answer: "'The thing speaks for itself.' A doctrine that allows a plaintiff to establish a breach of duty by circumstantial evidence. Requires showing that the accident is of a type that would not normally occur in the absence of negligence, and that the instrumentality causing the injury was in the defendant's exclusive control." },
      { question: "What is the difference between assault and battery?", answer: "**Battery** is the harmful or offensive touching of another. **Assault** is the creation of a reasonable apprehension of an imminent battery." },
      { question: "What are the elements of false imprisonment?", answer: "An act or omission by the defendant that confines or restrains the plaintiff to a bounded area, with intent, and causation. The plaintiff must be aware of the confinement or be harmed by it." },
      { question: "What is strict liability for abnormally dangerous activities?", answer: "A defendant is strictly liable for any harm that results from an abnormally dangerous activity, even if they exercised utmost care. The activity must create a foreseeable risk of serious harm even when reasonable care is exercised, and it must not be a matter of common usage." },
      { question: "What is the defense of consent?", answer: "A defendant is not liable for an otherwise tortious act if the plaintiff consented to it. Consent can be express or implied. It is not a valid defense if obtained by fraud or duress." },
      { question: "What is the defense of necessity?", answer: "A person may interfere with the real or personal property of another when it is reasonably and apparently necessary to avoid a threatened injury from a natural or other force, and the threatened injury is substantially more serious than the invasion that is undertaken to avert it." },
    ]
  },
  trusts: {
    subject: "Trusts",
    cards: [
        { question: "What are the essential elements of a valid private trust?", answer: "A valid trust requires (1) a **settlor** with capacity, (2) a clear **intent** to create a trust relationship, (3) a **trustee**, (4) **ascertainable beneficiaries**, and (5) **trust property** (res). The trust must also have a valid (legal) purpose." },
        { question: "What is a spendthrift trust?", answer: "A spendthrift trust is one that includes a provision that prevents the beneficiary from voluntarily or involuntarily transferring their interest in the trust. Creditors are generally unable to reach the beneficiary's interest, with exceptions for claims for child support, alimony, and claims by the government." },
        { question: "What is the Claflin doctrine?", answer: "A trust cannot be terminated, even if all beneficiaries consent, if doing so would be contrary to a material purpose of the settlor. For example, if the trust has a spendthrift provision or is intended to provide support for the beneficiary's lifetime." },
        { question: "What are the primary duties of a trustee?", answer: "A trustee owes fiduciary duties of loyalty (no self-dealing), care (to act as a prudent investor), and impartiality (to treat all beneficiaries fairly). They also have a duty to account and a duty not to commingle trust assets with their own." },
        { question: "What is a charitable trust?", answer: "A trust that has a charitable purpose (such as the relief of poverty, advancement of education or religion) and benefits a reasonably large and unidentifiable segment of the public. It is not subject to the Rule Against Perpetuities." },
        { question: "What is the Cy Pres doctrine?", answer: "If a charitable trust's purpose becomes illegal, impracticable, or impossible, a court may modify the trust to seek an alternative charitable purpose that is 'as near as possible' to the settlor's original intent." },
        { question: "What is a resulting trust?", answer: "An equitable remedy that arises when a trust fails or an express trust does not dispose of all of its property. The trustee must return the property to the settlor or the settlor's estate." },
        { question: "What is a constructive trust?", answer: "An equitable remedy imposed by a court to prevent unjust enrichment when a person has acquired property through wrongful conduct (e.g., fraud, undue influence). The wrongdoer is treated as a trustee who must return the property to the rightful owner." },
        { question: "What is the trustee's duty to diversify?", answer: "Under the Uniform Prudent Investor Act (UPIA), a trustee has a duty to diversify the investments of the trust unless the trustee reasonably determines that, because of special circumstances, the purposes of the trust are better served without diversifying." },
        { question: "Can a trustee delegate investment decisions?", answer: "Yes, a trustee may delegate investment and management functions that a prudent trustee of comparable skills could properly delegate under the circumstances. The trustee must exercise reasonable care in selecting the agent, establishing the scope of the delegation, and periodically reviewing the agent's actions." },
        { question: "What is the trustee's duty of impartiality?", answer: "If a trust has two or more beneficiaries, the trustee must act impartially in investing, managing, and distributing the trust property, giving due regard to the beneficiaries' respective interests." },
        { question: "How can a trust be terminated?", answer: "A trust can be terminated by its own terms, by the consent of the settlor and all beneficiaries, or by the consent of all beneficiaries if termination would not frustrate a material purpose of the trust (the Claflin doctrine)." },
        { question: "What is a 'pour-over' will?", answer: "A will that makes a gift to a trust. The trust can be created before or concurrently with the will. This allows property from the probate estate to be 'poured over' into the trust and administered according to its terms." },
        { question: "What is the trustee's duty not to commingle?", answer: "A trustee has a duty to keep trust property separate from their own property. If a trustee commingles trust assets with their own, any loss is presumed to be the trustee's, and any gain is presumed to belong to the trust." },
        { question: "What are the remedies for a trustee's breach of duty?", answer: "The court can (1) compel the trustee to perform their duties, (2) enjoin the trustee from committing a breach, (3) compel the trustee to pay money or restore property, (4) suspend or remove the trustee, or (5) reduce or deny the trustee's compensation." },
    ]
  },
  wills: {
    subject: "Wills & Decedent’s Estates",
    cards: [
        { question: "What are the requirements for a validly executed attested will?", answer: "A valid will must be (1) in writing, (2) signed by the testator (or by someone at the testator's direction and in their presence), and (3) signed by at least two witnesses, who signed in the testator's presence." },
        { question: "What is an interested witness?", answer: "An interested witness is a witness to a will who is also a beneficiary. At common law, such a will was void. Under the modern majority rule, the will is still valid, but the gift to the interested witness is purged to the extent it exceeds what the witness would have received in intestacy." },
        { question: "What is a Holographic Will?", answer: "A will that is written in the testator's handwriting. In jurisdictions that recognize them, the material provisions must be in the testator's handwriting and it must be signed by the testator. Witnesses are not required." },
        { question: "What is the Anti-Lapse Statute?", answer: "Prevents a gift from failing (lapsing) when a beneficiary predeceases the testator. If the beneficiary is a specified relative of the testator and left issue (descendants), the gift passes to the issue instead of the residuary." },
        { question: "What is the doctrine of ademption?", answer: "If a specific gift in a will is no longer in the testator's estate at the time of death, the gift is adeemed (it fails). Most jurisdictions have created exceptions to avoid ademption, such as if the property was sold but there are outstanding proceeds." },
        { question: "What is a pretermitted child?", answer: "A child born or adopted after the execution of a will who is not mentioned in the will. Most states have statutes that allow a pretermitted child to take an intestate share, on the theory that the omission was accidental." },
        { question: "What is the doctrine of incorporation by reference?", answer: "A will may incorporate an extrinsic document into the will if: (1) the document was in existence at the time the will was executed, (2) the will manifests an intent to incorporate the document, and (3) the will describes the document with sufficient certainty to identify it." },
        { question: "What is a codicil?", answer: "A supplement to a will that alters, amends, or modifies it. A codicil must be executed with the same formalities as a will. A validly executed codicil republishes the will as of the date of the codicil." },
        { question: "How can a will be revoked?", answer: "By (1) a subsequent testamentary instrument executed with the proper formalities, or (2) by physical act (e.g., burning, tearing, canceling, obliterating) with the intent to revoke." },
        { question: "What is the doctrine of dependent relative revocation (DRR)?", answer: "Allows a court to disregard a revocation if it determines that the act of revocation was premised on a mistake of law or fact and would not have occurred but for that mistake. It is most often applied when a testator revokes a will on the mistaken belief that a new will is valid." },
        { question: "What is a specific, general, and demonstrative legacy?", answer: "* **Specific Legacy:** A gift of a particular item of property (e.g., 'my Rolex watch').\n* **General Legacy:** A gift of a general economic benefit, payable out of the general assets of the estate (e.g., '$10,000').\n* **Demonstrative Legacy:** A gift of a general amount to be paid from a particular source (e.g., '$10,000 from the sale of my Apple stock')." },
        { question: "What is abatement?", answer: "The process of reducing testamentary gifts when the estate assets are insufficient to pay all claims and satisfy all bequests. Unless the will specifies otherwise, gifts abate in the following order: intestate property, residuary gifts, general gifts, and then specific gifts." },
        { question: "What is a surviving spouse's elective share?", answer: "A statutory share of a decedent's estate that a surviving spouse may choose to take instead of the share they were given in the will. This protects against disinheritance." },
        { question: "What is required for a testator to have testamentary capacity?", answer: "The testator must be capable of knowing and understanding in a general way (1) the nature and extent of their property, (2) the natural objects of their bounty (their family), and (3) the disposition they are making of that property." },
        { question: "What is undue influence in the context of a will?", answer: "Undue influence occurs when a person exerts such influence over the testator that it overcomes the testator's free will and causes the testator to make a will that they would not otherwise have made. A confidential relationship and suspicious circumstances can raise a presumption of undue influence." },
    ]
  },
  conlaw: {
    subject: "Constitutional Law",
    cards: [
        { question: "What is the difference between Procedural Due Process and Substantive Due Process?", answer: "* **Procedural Due Process** requires the government to provide **notice and an opportunity to be heard** before depriving a person of life, liberty, or property. The amount of process due is determined by balancing: (1) the importance of the individual's interest, (2) the risk of an erroneous deprivation through the procedures used, and (3) the government's interest in efficiency.\n* **Substantive Due Process** limits the **substance** of what a government can regulate. It asks whether the government has an adequate reason for the deprivation. If a law limits a **fundamental right** (e.g., travel, voting, privacy), it is subject to **strict scrutiny**. If it does not, it is subject to **rational basis** review." },
        { question: "What is the Dormant Commerce Clause?", answer: "The Dormant Commerce Clause is a constitutional principle that limits a state's ability to pass laws that unduly burden interstate commerce. If a state law discriminates against out-of-state commerce, it is presumptively invalid unless the state can show it is necessary to achieve an important, non-economic state interest. If the law is non-discriminatory but still burdens interstate commerce, the court will balance the law's benefits against the burden on commerce." },
        { question: "What are the three levels of scrutiny for Equal Protection claims?", answer: "1. **Strict Scrutiny:** Applies to classifications based on race, alienage, and national origin. The law must be **necessary** to achieve a **compelling** government interest.\n2. **Intermediate Scrutiny:** Applies to classifications based on gender and non-marital children. The law must be **substantially related** to an **important** government interest.\n3. **Rational Basis:** Applies to all other classifications (e.g., age, wealth, disability). The law must be **rationally related** to a **legitimate** government interest." },
        { question: "What is required for a law to be a valid time, place, and manner restriction on speech in a public forum?", answer: "The restriction must be (1) content-neutral, (2) narrowly tailored to serve a significant government interest, and (3) leave open ample alternative channels for communication." },
        { question: "What is the Takings Clause of the Fifth Amendment?", answer: "The government may not take private property for public use without just compensation. A taking can be a physical occupation or a regulation that leaves no economically viable use of the property." },
        { question: "What is the 'state action' requirement?", answer: "The Constitution's protections of individual liberties and equal protection apply only to government action (state action), not the actions of private individuals or entities. An exception exists when a private entity is performing a traditional and exclusive public function or when there is significant state involvement with the private entity." },
        { question: "What is the Supremacy Clause?", answer: "Article VI provides that the Constitution, and laws and treaties made pursuant to it, are the supreme law of the land. Federal law preempts conflicting state law. Preemption can be express or implied (field preemption or conflict preemption)." },
        { question: "What is Congress's power under the Commerce Clause?", answer: "Congress can regulate (1) the channels of interstate commerce, (2) the instrumentalities of interstate commerce, and (3) activities that have a substantial effect on interstate commerce." },
        { question: "What is the standard for regulating commercial speech?", answer: "Truthful commercial speech can be regulated if the regulation (1) serves a substantial government interest, (2) directly advances that interest, and (3) is narrowly tailored to serve that interest (a reasonable fit)." },
        { question: "What is the Establishment Clause?", answer: "The First Amendment prohibits the government from making any law 'respecting an establishment of religion.' A government action that prefers one religion over another is subject to strict scrutiny. If the action is neutral, the Lemon test is often applied: the action must have a secular purpose, its primary effect must not advance or inhibit religion, and it must not create excessive government entanglement." },
        { question: "What is the Free Exercise Clause?", answer: "The First Amendment prohibits the government from interfering with the free exercise of religion. The government cannot punish someone for their religious beliefs. However, a neutral law of general applicability may be applied to religious conduct, even if it has an incidental burden on religion." },
        { question: "What are the requirements for standing to sue in federal court?", answer: "A plaintiff must show (1) an injury in fact that is concrete and particularized, (2) causation (the injury is fairly traceable to the defendant's conduct), and (3) redressability (a favorable court decision is likely to remedy the injury)." },
        { question: "What is the Privileges and Immunities Clause of Article IV?", answer: "Prohibits states from discriminating against citizens of other states with respect to fundamental rights or important economic activities. A state can only discriminate if it has a substantial justification and there are no less restrictive means." },
        { question: "What is the Contracts Clause?", answer: "Limits the ability of states to enact laws that retroactively impair contract rights. It rarely applies to the federal government." },
        { question: "What is executive privilege?", answer: "The President has a qualified privilege to not disclose confidential communications with presidential advisers. This privilege can be outweighed by a specifically demonstrated need in a criminal prosecution." },
    ]
  }
};

// --- Helper Icon Components ---
const ChevronLeftIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6" /></svg>
);
const ChevronRightIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6" /></svg>
);
const ShuffleIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22"/><path d="m18 2 4 4-4 4"/><path d="M2 6h1.9c1.5 0 2.9.9 3.6 2.2l4.3 8.2c.7 1.3 2.1 2.2 3.6 2.2H22"/><path d="m18 22-4-4 4-4"/></svg>
);

// --- Flashcard Component ---
const Flashcard = ({ card, isFlipped, onFlip }) => {
  return (
    <div className="w-full h-full perspective-1000" onClick={onFlip}>
      <div className={`relative w-full h-full transform-style-3d transition-transform duration-700 ${isFlipped ? 'rotate-y-180' : ''}`}>
        <div className="absolute w-full h-full backface-hidden bg-white rounded-xl shadow-lg flex items-center justify-center p-4 md:p-6 border border-gray-200">
          <p className="text-xl landscape:text-lg sm:text-2xl text-center text-gray-800">{card.question}</p>
        </div>
        <div className="absolute w-full h-full backface-hidden bg-gray-100 rounded-xl shadow-lg p-4 md:p-6 border border-gray-200 rotate-y-180 overflow-y-auto">
          <p className="text-base landscape:text-sm sm:text-lg text-gray-700 whitespace-pre-line">{card.answer}</p>
        </div>
      </div>
    </div>
  );
};

// --- Helper function to get initial state from localStorage ---
const getInitialDeckKey = () => {
  try {
    const savedSelection = localStorage.getItem('barExamDeckSelection');
    if (savedSelection) {
      const { key, timestamp } = JSON.parse(savedSelection);
      const threeHours = 3 * 60 * 60 * 1000; // 3 hours in milliseconds
      
      // Check if the saved key is valid and not expired
      if (allDecks[key] && (Date.now() - timestamp < threeHours)) {
        return key;
      }
    }
  } catch (error) {
    console.error("Could not parse saved deck selection:", error);
  }
  return 'agency'; // Default to 'agency' if nothing is saved, it's expired, or invalid
};


// --- Main App Component ---
export default function App() {
  const windowHeight = useWindowHeight();
  const [deckKey, setDeckKey] = useState(getInitialDeckKey);
  const [deck, setDeck] = useState(allDecks[deckKey]);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isFlipped, setIsFlipped] = useState(false);

  // State for touch swipe
  const [touchStart, setTouchStart] = useState(null);
  const [touchEnd, setTouchEnd] = useState(null);
  const minSwipeDistance = 50;

  const currentCard = useMemo(() => deck.cards[currentIndex], [deck, currentIndex]);

  const changeDeck = (newDeckKey) => {
    setIsFlipped(false);
    setTimeout(() => {
      setDeckKey(newDeckKey);
      setDeck(allDecks[newDeckKey]);
      setCurrentIndex(0);

      // Save the new selection and timestamp to localStorage
      try {
        const selection = {
          key: newDeckKey,
          timestamp: Date.now()
        };
        localStorage.setItem('barExamDeckSelection', JSON.stringify(selection));
      } catch (error) {
        console.error("Could not save deck selection:", error);
      }
    }, 150);
  };

  const handleNext = () => {
    setIsFlipped(false);
    setTimeout(() => {
      setCurrentIndex((prevIndex) => (prevIndex + 1) % deck.cards.length);
    }, 150);
  };

  const handlePrev = () => {
    setIsFlipped(false);
    setTimeout(() => {
      setCurrentIndex((prevIndex) => (prevIndex - 1 + deck.cards.length) % deck.cards.length);
    }, 150);
  };

  const handleShuffle = () => {
    setIsFlipped(false);
    setTimeout(() => {
      const shuffledCards = [...deck.cards].sort(() => Math.random() - 0.5);
      setDeck(prevDeck => ({ ...prevDeck, cards: shuffledCards }));
      setCurrentIndex(0);
    }, 150);
  };

  const handleFlip = () => {
    setIsFlipped(!isFlipped);
  };
  
  const handleTouchStart = (e) => {
    setTouchEnd(null); // Reset touch end on new touch
    setTouchStart(e.targetTouches[0].clientX);
  };

  const handleTouchMove = (e) => {
    setTouchEnd(e.targetTouches[0].clientX);
  };

  const handleTouchEnd = () => {
    if (touchStart === null || touchEnd === null) {
        // This case handles taps, which are now managed by the main onClick
        return;
    }
    const distance = touchStart - touchEnd;
    const isLeftSwipe = distance > minSwipeDistance;
    const isRightSwipe = distance < -minSwipeDistance;

    if (isLeftSwipe) {
      handleNext();
    } else if (isRightSwipe) {
      handlePrev();
    }

    setTouchStart(null);
    setTouchEnd(null);
  };


  return (
    <div className="bg-gray-50 w-screen flex flex-col font-sans" style={{ height: windowHeight }}>
      <div className="w-full max-w-2xl mx-auto flex flex-col h-full p-2 sm:p-4">
        <header className="flex-shrink-0 text-center py-2 landscape:py-1">
          {/* The subject title has been removed from here */}
        </header>

        <div className="flex-shrink-0 mb-4 landscape:mb-2 w-full max-w-xs mx-auto">
          {/* The label has been removed from here */}
          <select
            id="deck-select"
            value={deckKey}
            onChange={(e) => changeDeck(e.target.value)}
            className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm"
            aria-label="Select Subject"
          >
            {Object.keys(allDecks).map(key => (
              <option key={key} value={key}>{allDecks[key].subject}</option>
            ))}
          </select>
        </div>

        <main 
          className="flex-grow relative min-h-0"
          onTouchStart={handleTouchStart}
          onTouchMove={handleTouchMove}
          onTouchEnd={handleTouchEnd}
        >
          {currentCard ? (
            <Flashcard card={currentCard} isFlipped={isFlipped} onFlip={handleFlip} /> 
          ) : (
            <div className="w-full h-full bg-white rounded-xl shadow-lg flex items-center justify-center p-6 border border-gray-200">
                <p className="text-xl text-gray-500">No cards in this deck.</p>
            </div>
          )}
        </main>

        <footer className="flex-shrink-0 py-2 landscape:py-1 hidden sm:block">
          <div className="flex items-center justify-center mb-2 landscape:mb-1">
            <p className="text-gray-600 font-medium">
              Card {deck.cards.length > 0 ? currentIndex + 1 : 0} of {deck.cards.length}
            </p>
          </div>
          <div className="flex items-center justify-center gap-2">
            <button onClick={handlePrev} className="flex items-center justify-center p-3 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50" aria-label="Previous card"><ChevronLeftIcon /></button>
            <button onClick={handleShuffle} className="flex items-center gap-2 px-6 py-3 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 font-semibold text-gray-700" aria-label="Shuffle deck"><ShuffleIcon /> Shuffle</button>
            <button onClick={handleNext} className="flex items-center justify-center p-3 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50" aria-label="Next card"><ChevronRightIcon /></button>
          </div>
        </footer>
      </div>
    </div>
  );
}

// --- Custom CSS for 3D transform effects ---
const style = document.createElement('style');
style.innerHTML = `
  .perspective-1000 { perspective: 1000px; }
  .transform-style-3d { transform-style: preserve-3d; }
  .rotate-y-180 { transform: rotateY(180deg); }
  .backface-hidden { backface-visibility: hidden; -webkit-backface-visibility: hidden; }
`;
document.head.appendChild(style);
